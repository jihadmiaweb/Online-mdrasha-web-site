import React, { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { BookOpen, Users, Clock, Search, ArrowRight, ChevronDown, Globe } from "lucide-react";
import { Link } from "react-router";

// --- ржбрзЗржЯрж╛ рж╕рзЛрж░рзНрж╕ (Data Source) ---
const instructors = [
    {
        id: 1, name: "ржб. ржорзЛрж╣рж╛ржорзНржоржж рж░рж╛рж╢рж┐ржж", title: "ржЗрж╕рж▓рж╛ржорж┐ржХ ржЗрждрж┐рж╣рж╛рж╕ржмрж┐ржЬрзНржЮрж╛ржирзА",
        bio: "ржмрж┐рж╢рзНрж▓рзЗрж╖ржгрж╛рждрзНржоржХ рж╕рзАрж░рж╛рж╣ ржУ ржЗрж╕рж▓рж╛ржорзА ржЗрждрж┐рж╣рж╛рж╕рзЗ ржЧржмрзЗрж╖ржХ; рззрзл ржмржЫрж░рзЗрж░ рж╢рж┐ржХрзНрж╖рж╛ржжрж╛ржи ржЕржнрж┐ржЬрзНржЮрждрж╛ред",
        photo: "/imgas/Qualified-Islamic-Scholars/download(3).jpeg"
    },
    { id: 2, name: "ржкрзНрж░ржл. рж╕рж╛ржмрж┐ржирж╛ ржкрж╛рж░ржнрзАржи", title: "рждржерзНржпржнрж┐рждрзНрждрж┐ржХ ржмрж╛ржпрж╝рзЛржЧрзНрж░рж╛ржлрж┐ рж╢рж┐ржХрзНрж╖ржХ", bio: "ржиржмрзАрж░ ржЬрзАржмржирзА ржУ рж╕рж╛ржорж╛ржЬрж┐ржХ ржкрзНрж░рзЗржХрзНрж╖рж╛ржкржЯрзЗ ржжржХрзНрж╖; ржмрж┐ржнрж┐ржирзНржи ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ ржЬрж╛рж░рзНржирж╛рж▓рзЗ ржкрзНрж░ржХрж╛рж╢ржирж╛ ржЖржЫрзЗред", photo: "/imgas/Qualified-Islamic-Scholars/download (1).jpeg" },
];

const curriculum = [
    { id: 1, title: "ржкрзНрж░рж╛ржержорж┐ржХ ржЬрзАржмржи ржУ ржкрзНрж░рж╛ржХ-ржиржмржмрзА ржпрзБржЧ", desc: "ржЖрж░ржм рж╕ржорж╛ржЬрзЗрж░ ржЕржмрж╕рзНржерж╛ ржУ ржиржмрж┐ржЬрж┐рж░ рж╢рзИрж╢ржмржХрж╛рж▓", points: ["ржЖрж░ржм рж╕ржорж╛ржЬрзЗрж░ ржЕржмрж╕рзНржерж╛", "ржмрж╛ржмрж╛-ржорж╛ржпрж╝рзЗрж░ рж╕рзВрждрзНрж░", "ржоржХрзНржХрж╛рж░ рж░рж╛ржЬржирзИрждрж┐ржХ ржУ рж╕рж╛ржорж╛ржЬрж┐ржХ ржХрж╛ржарж╛ржорзЛ"] },
    { id: 2, title: "ржирзЛржмрзБрждрзНржм ржУ ржоржХрзНржХрж╛ржпрж╝ ржкрзНрж░ржЪрж╛рж░", desc: "ржкрзНрж░ржержо ржУржпрж╝рж╛рж╣рж┐ ржУ ржЗрж╕рж▓рж╛ржорзЗрж░ ржкрзНрж░рж╛ржержорж┐ржХ ржжрж╛ржУржпрж╝рж╛ржд", points: ["ржкрзНрж░ржержо ржЖрж╣рж▓рзЗ ржХрж┐рждрж╛ржм ржУ ржЙржкржжрзЗрж╢", "ржИржорж╛ржиржЧрзНрж░рж╣ржгржХрж╛рж░рзАржжрзЗрж░ ржкрж░рзАржХрзНрж╖рж╛ржЧрзБрж▓рж┐", "ржоржХрзНржХрж╛рж░ ржмрж┐рж░рзЛржзрж┐рждрж╛ ржУ рж╕рж╣рж┐ржВрж╕рждрж╛"] },
    { id: 3, title: "рж╣рж┐ржЬрж░ржд ржУ ржоржжрж┐ржирж╛ржпрж╝ ржкрзНрж░рждрж┐рж╖рзНржарж╛", desc: "ржоржжрж┐ржирж╛рж░ ржкрзНрж░ржержо ржорзБрж╕рж▓рж┐ржо рж╕ржорж╛ржЬ ржЧржаржи", points: ["ржоржжрж┐ржирж╛ржпрж╝ ржкрзМржЫрж╛ржирзЛ ржУ рж╕рж╛ржорж╛ржЬрж┐ржХ ржЪрзБржХрзНрждрж┐", "ржЦрж┐рж▓рж╛ржлржд ржЧржаржирзЗрж░ рж╕рзВржЪржирж╛", "ржорж╣рж╛ржХрж╛ржмрзНржпрж┐ржХ ржпрзБржжрзНржз ржУ ржХрзБржЯржирзАрждрж┐"] },
    { id: 4, title: "ржоржжрж┐ржирж╛ржпрж╝ рж╕ржорж╛ржЬржЧржаржи ржУ ржзрж░рзНржорзАржпрж╝ ржЖржЗржи", desc: "ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржирзАрждрж┐ржорж╛рж▓рж╛ ржУ ржмрж┐ржЪрж╛рж░рж┐ржХ рж╕рж┐ржжрзНржзрж╛ржирзНрждрж╕ржорзВрж╣", points: ["ржорж╛ржиржмрж┐ржХ ржирзАрждрж┐ржорж╛рж▓рж╛", "ржорж╛ржЗржирж╛рж░рж┐ржЯрж┐ ржУ рж╢рж╛ржирзНрждрж┐ ржЪрзБржХрзНрждрж┐", "ржЖржЗржирж┐ ржУ ржЖржЪрж╛рж░-ржмрзНржпржмрж╣рж╛рж░рж┐ржХ рж╕рж┐ржжрзНржзрж╛ржирзНрждрж╕ржорзВрж╣"] },
    { id: 5, title: "ржкрж░ржмрж░рзНрждрзА ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржкрзНрж░рзЗржХрзНрж╖рж╛ржкржЯ ржУ ржкрзНрж░ржнрж╛ржм", desc: "ржиржмрж┐ржЬрж┐рж░ ржЗржирзНрждрзЗржХрж╛рж▓рзЗрж░ ржкрж░ ржЗрж╕рж▓рж╛ржорзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░", points: ["рж░рж╛рж╢рж┐ржжрзБржи ржЦрж┐рж▓рж╛ржлрж╛", "ржЗрж╕рж▓рж╛ржорзЗрж░ ржжрзНрж░рзБржд ржмрж┐рж╕рзНрждрж╛рж░", "ржЗрждрж┐рж╣рж╛рж╕рзЗ ржиржмрзАрж░ рж╢рж┐ржХрзНрж╖рж╛рж░ ржкрзНрж░ржнрж╛ржм"] },
];

const timeline = [
    { year: "570 CE", title: "ржЬржирзНржо (ржЕржирзНрждржГрж╢рж╣рж░рзЗ) тАФ ржоржХрзНржХрж╛" },
    { year: "610 CE", title: "ржкрзНрж░ржержо ржУржпрж╝рж╛рж╣рж┐ ржУ ржиржмрзБржУржпрж╝ржд ржкрзНрж░рждрж┐рж╖рзНржарж╛" },
    { year: "622 CE", title: "рж╣рж┐ржЬрж░ржд: ржоржХрзНржХрж╛ ржерзЗржХрзЗ ржоржжрж┐ржирж╛" },
    { year: "630 CE", title: "ржоржХрзНржХрж╛рж░ ржмрж┐ржЬржпрж╝" },
    { year: "632 CE", title: "ржиржмрзАрж░ ржЗржирзНрждрзЗржХрж╛рж▓ ржУ ржЗрж╕рж▓рж╛ржорзЗ ржЕржкрж░рж┐ржмрж░рзНрждржирзАржпрж╝ ржзрж╛рж░рж╛" },
];

// --- ржирждрзБржи ржХржорзНржкрзЛржирзЗржирзНржЯ: ржкрж╛ржарзНржпржХрзНрж░ржорзЗрж░ ржЖржЗржЯрзЗржо (Curriculum Item) ---
type CurriculumItemProps = {
    item: {
        id: number;
        title: string;
        desc: string;
        points: string[];
    };
    expanded: number | null;
    setExpanded: (id: number | null) => void;
};

const CurriculumItem: React.FC<CurriculumItemProps> = ({ item, expanded, setExpanded }) => {
    const isOpen = expanded === item.id;

    return (
        <motion.div
            layout
            className="p-3 bg-white rounded-lg border border-slate-200 shadow-sm"
        >
            <button
                onClick={() => setExpanded(isOpen ? null : item.id)}
                className="w-full text-left flex items-center justify-between py-1 focus:outline-none"
                aria-expanded={isOpen}
            >
                <div>
                    <div className="font-bold text-gray-800">{item.title}</div>
                    <div className="text-xs text-slate-600 mt-1">{item.desc}</div>
                </div>
                <motion.div
                    animate={{ rotate: isOpen ? 180 : 0 }}
                    transition={{ duration: 0.3 }}
                    className="ml-4 text-indigo-600"
                >
                    <ChevronDown size={20} />
                </motion.div>
            </button>

            <AnimatePresence>
                {isOpen && (
                    <motion.div
                        layout
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: 'auto' }}
                        exit={{ opacity: 0, height: 0 }}
                        transition={{ opacity: { duration: 0.2 }, height: { duration: 0.4 } }}
                        className="pt-3 text-sm text-slate-700 overflow-hidden border-t mt-3 border-slate-100"
                    >
                        <ul className="list-disc ml-5 space-y-1 mt-1 pb-1">
                            {item.points.map((p, i) => <li key={i} className="py-0.5 text-slate-600">{p}</li>)}
                        </ul>
                    </motion.div>
                )}
            </AnimatePresence>
        </motion.div>
    );
};


// --- ржорзВрж▓ ржХржорзНржкрзЛржирзЗржирзНржЯ (Main Component) ---
export default function SirahHistory({ className = "" }) {
    const [selectedInstructor, setSelectedInstructor] = useState(instructors[0]);
    // Renaming activeIndex to expandedCurriculum for clarity
    const [expandedCurriculum, setExpandedCurriculum] = useState<number | null>(null);

    return (
        <div className={`max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-xl border border-slate-100 ${className}`}>
            <motion.header
                initial={{ y: -8, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                transition={{ duration: 0.4 }}
            >
                <h1 className="text-3xl font-extrabold text-indigo-800 mb-2">рж╕рзАрж░рж╛рж╣ ржУ ржЗрж╕рж▓рж╛ржорзА ржЗрждрж┐рж╣рж╛рж╕ ЁЯУЪ</h1>
                <p className="text-base text-slate-600">ржиржмрзА ржорзБрж╣рж╛ржорзНржоржж (рж╕рж╛.)-ржПрж░ ржЬрзАржмржирзА, рж╢рж┐ржХрзНрж╖рж╛ ржУ ржЗрж╕рж▓рж╛ржорзЗрж░ ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржШржЯржирж╛ржЧрзБрж▓рзЛрж░ ржмрж┐рж╢ржж ржУ ржмрж┐рж╢рзНрж▓рзЗрж╖ржгрж╛рждрзНржоржХ ржкрж╛ржарзНржпржХрзНрж░ржоред</p>
                <div className="flex items-center gap-4 text-sm mt-3 text-indigo-600 font-medium">
                    <div className="flex items-center gap-1"><Globe size={14} /> ржмрж┐рж╢рзНржмржЬржирзАржи рж╢рж┐ржХрзНрж╖рж╛</div>
                    <div className="flex items-center gap-1"><Clock size={14} /> ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг</div>
                </div>
            </motion.header>

            <hr className="my-6 border-slate-100" />

            <section className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {/* --- ржкрзНрж░ржзрж╛ржи ржмрж┐рж╖ржпрж╝ржмрж╕рзНрждрзБ: ржкрж╛ржарзНржпржХрзНрж░ржо ржУ рж╕ржоржпрж╝рж░рзЗржЦрж╛ (Curriculum & Timeline) --- */}
                <div className="md:col-span-2 space-y-8">
                    {/* ржкрж╛ржарзНржпржХрзНрж░ржо (Curriculum) */}
                    <div className="bg-slate-50 p-5 rounded-xl border border-slate-100">
                        <h2 className="font-bold text-xl mb-4 flex items-center gap-2 text-gray-800">
                            <BookOpen size={20} className="text-indigo-600" /> ржХрзЛрж░рзНрж╕рзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржкрж╛ржарзНржпржХрзНрж░ржо
                        </h2>
                        <div className="space-y-4">
                            {curriculum.map((c) => (
                                <CurriculumItem
                                    key={c.id}
                                    item={c}
                                    expanded={expandedCurriculum}
                                    setExpanded={setExpandedCurriculum}
                                />
                            ))}
                        </div>
                    </div>

                    {/* ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рж╕ржоржпрж╝рж░рзЗржЦрж╛ (Timeline) */}
                    <div className="bg-white p-5 rounded-xl border border-slate-100">
                        <h3 className="font-bold text-xl mb-4 flex items-center gap-2 text-gray-800">
                            <Clock size={20} className="text-indigo-600" /> ржорзВрж▓ рж╕ржоржпрж╝рж░рзЗржЦрж╛
                        </h3>
                        <div className="relative border-l border-indigo-200 pl-4 space-y-6">
                            {timeline.map((t, i) => (
                                <motion.li
                                    key={i}
                                    initial={{ x: -20, opacity: 0 }}
                                    animate={{ x: 0, opacity: 1 }}
                                    transition={{ duration: 0.3, delay: i * 0.1 }}
                                    className="relative flex items-start gap-4"
                                >
                                    <div className="absolute -left-3 top-1 w-6 h-6 bg-indigo-600 rounded-full ring-4 ring-white shadow-md"></div>
                                    <div className="ml-2 pt-1">
                                        <div className="font-mono text-xs text-indigo-700 font-semibold">{t.year}</div>
                                        <div className="font-medium text-gray-800 mt-0.5">{t.title}</div>
                                    </div>
                                </motion.li>
                            ))}
                        </div>
                    </div>
                </div>

                {/* --- рж╕рж╛ржЗржбржмрж╛рж░: рж╢рж┐ржХрзНрж╖ржХ ржУ ржПржирж░рзЛрж▓ржорзЗржирзНржЯ (Sidebar: Instructor & Enrollment) --- */}
                <aside className="md:col-span-1">
                    <div className="sticky md:top-6 space-y-6">
                        {/* рж╢рж┐ржХрзНрж╖ржХ ржирж┐рж░рзНржмрж╛ржЪржи ржУ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд */}
                        <div className="bg-indigo-50 p-5 rounded-xl border border-indigo-200 shadow-md">
                            <h4 className="font-bold text-lg mb-3 flex items-center gap-2 text-gray-800">
                                <Users size={18} className="text-indigo-700" /> рж╢рж┐ржХрзНрж╖ржХржмрзГржирзНржж
                            </h4>
                            <div className="space-y-3">
                                {instructors.map((ins) => (
                                    <button
                                        key={ins.id}
                                        onClick={() => setSelectedInstructor(ins)}
                                        className={`w-full text-left p-3 rounded-lg transition-all flex items-center gap-3 ${selectedInstructor.id === ins.id ? 'bg-white shadow-lg ring-2 ring-indigo-400' : 'hover:bg-indigo-100/70'}`}
                                        aria-current={selectedInstructor.id === ins.id ? "true" : "false"}
                                    >
                                        <img src={ins.photo} alt={ins.name} className="w-10 h-10 rounded-full object-cover shadow-sm" />
                                        <div>
                                            <div className="font-semibold text-gray-800">{ins.name}</div>
                                            <div className="text-xs text-slate-600">{ins.title}</div>
                                        </div>
                                    </button>
                                ))}
                            </div>

                            <div className="mt-5 pt-4 border-t border-indigo-200 text-sm text-slate-700">
                                <div className="font-semibold text-gray-800 mb-1">ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржЧржмрзЗрж╖ржХ:</div>
                                <p className="mt-1">{selectedInstructor.bio}</p>
                            </div>
                        </div>

                        {/* ржПржирж░рзЛрж▓ржорзЗржирзНржЯ ржмрж╛ржЯржи */}
                        <motion.button
                            whileHover={{ scale: 1.02 }}
                            whileTap={{ scale: 0.98 }}
                            className="w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold text-lg shadow-xl hover:bg-indigo-700 transition-all duration-300"
                        >
                            <Link to={"/CourseEnrollment"}>
                                ржХрзЛрж░рзНрж╕рзЗ ржнрж░рзНрждрж┐ рж╣ржи
                            </Link>
                            <ArrowRight size={20} />
                        </motion.button>

                        {/* рж░рж┐рж╕рзЛрж░рзНрж╕ ржУ ржкрж╛ржарзНржпржкрзБрж╕рзНрждржХ */}
                        <div className="p-5 bg-white rounded-xl border border-slate-100 shadow-sm">
                            <h5 className="font-bold text-lg mb-3 flex items-center gap-2 text-gray-800">
                                <Search size={18} className="text-indigo-600" /> рж░рж┐рж╕рзЛрж░рзНрж╕ ржУ ржкрж╛ржарзНржпржкрзБрж╕рзНрждржХ
                            </h5>
                            <ul className="text-sm text-slate-700 space-y-2">
                                <li className="flex items-start gap-2"><div className="text-indigo-600 pt-1">тАв</div> рждрж╛ржлрж╕рзАрж░ ржУ рж╕рзАрж░рж╛рж╣рзЗрж░ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржкрж╛ржа</li>
                                <li className="flex items-start gap-2"><div className="text-indigo-600 pt-1">тАв</div> ржкрзНрж░ржЪрж▓рж┐ржд ржЗрждрж┐рж╣рж╛рж╕рж┐ржХ ржЙрзОрж╕ржЧрзБрж▓рзЛрж░ рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржкрж░рж┐ржЪрж┐рждрж┐</li>
                                <li className="flex items-start gap-2"><div className="text-indigo-600 pt-1">тАв</div> ржЕржирж▓рж╛ржЗржи ржЖрж░ржХрж╛ржЗржн ржУ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ рж▓рж┐ржВржХ</li>
                            </ul>
                        </div>
                    </div>
                </aside>
            </section>

            <footer className="mt-10 text-center text-sm text-slate-500 border-t pt-4 border-slate-100">ржкрзНрж░рж╕рзНрждрзБрждржХрж╛рж░ржХ: QuranEd тАв рж▓ржХрзНрж╖рзНржп: рждржерзНржпржнрж┐рждрзНрждрж┐ржХ, рж╕ржорзНржорж╛ржиржЬржиржХ ржУ рж╢рж┐ржХрзНрж╖ржгрзАржпрж╝ ржЙржкрж╕рзНржерж╛ржкржирж╛ред</footer>
        </div>
    );
}